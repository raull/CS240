package client.search;

import java.util.ArrayList;

import shared.communication.Get_Projects_Parameter;
import shared.communication.Get_Projects_Response;
import shared.communication.Validate_User_Parameter;
import shared.communication.Validate_User_Response;
import shared.modal.Project;
import client.communication.ClientCommunicator;

public class SearchController {
	
	private ClientCommunicator clientCommunicator;
	private String username;
	private String password;
	private SearchFrame view;
	
	public SearchController() {
		this.view = new SearchFrame(this);
		this.view.presedLoginDialog();
		this.view.setVisible(true);
	}
	
	public void loginUser(String username, String password, String host, String port) {
		
		try {
			//Start Client Communicator
			this.clientCommunicator = new ClientCommunicator(host, port);
		} catch (Exception e) {
			view.loginFailed("Error connecting, please check host and port and try again");
			return;
		}
		
		try {
			
			//Validate User
			Validate_User_Parameter param = new Validate_User_Parameter(username, password);
			Validate_User_Response response = clientCommunicator.validateUser(param);
			if (response.getOutput().equals("FALSE")) {
				view.loginFailed("Wrong username and password");
			} else if (response.getOutput().equals("FAILED")) {
				view.loginFailed("Error: please try again later");
			} else {
				this.username = username;
				this.password = password;
				
				view.loginSuccesfull();
			}
		} catch (Exception e) {
			view.loginFailed("Error: please try again later");
		}
	}
	
	public void getProjects() {
		
		try {
			Get_Projects_Parameter param = new Get_Projects_Parameter(this.username, this.password);
			Get_Projects_Response response = clientCommunicator.getProjects(param);
			
			if (!response.getOutput().equals("FAILED")) {
				String[] projectNames = new String[response.getProjects().size()];
				ArrayList<Project> projects = (ArrayList<Project>)response.getProjects();
				
				for (int i=0; i<response.getProjects().size(); i++) {
					projectNames[i] = response.getProjects().get(i).getTitle();
				}
				
				view.updateProjects(projectNames);
			}
			
		} catch (Exception e) {
			System.out.println("Get Projects Failed");
		}
		
		
		
	}

	//Getters and Setters
	
	/**
	 * @return the username
	 */
	public String getUsername() {
		return username;
	}

	/**
	 * @return the password
	 */
	public String getPassword() {
		return password;
	}
}
